/**
 * jQuery CSS Customizable Scrollbar
 *
 * Copyright 2014, Yuriy Khabarov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * If you found bug, please contact me via email <13real008@gmail.com>
 *
 * @author Yuriy Khabarov aka Gromo
 * @version 0.2.1
 * @url https://github.com/gromo/jquery.scrollbar/
 *
 * TODO:
 *
 */
(function(e,t,n){function h(){if(r.webkit){return{height:0,width:0}}var t={border:"none",height:"100px",margin:"0",padding:"0",width:"100px"};var n=e("<div>").css(e.extend({},t));var i=e("<div>").css(e.extend({background:"#F00",left:"-200px",overflow:"scroll",position:"absolute",top:"-200px"},t)).append(n).appendTo("body").scrollLeft(n.width()).scrollTop(n.height());var s={height:i.offset().top-n.offset().top||0,width:i.offset().left-n.offset().left||0};i.remove();return s}function p(n,r){e(t).on({"blur.scrollbar":function(){e(t).add("body").off(".scrollbar");n&&n()},"dragstart.scrollbar":function(e){e.preventDefault();return false},"mouseup.scrollbar":function(){e(t).add("body").off(".scrollbar");n&&n()}});e("body").on({"selectstart.scrollbar":function(e){e.preventDefault();return false}});r&&r.preventDefault();return false}function d(e){var t=e.originalEvent;if(t.axis&&t.axis===t.HORIZONTAL_AXIS)return false;if(t.wheelDeltaX)return false;return true}var r={mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(n.navigator.userAgent),webkit:n.WebKitPoint?true:false,log:function(t,r){var i=t;if(r&&typeof t!="string"){i=[];e.each(t,function(e,t){i.push('"'+e+'": '+t)});i=i.join(", ")}if(n.console&&n.console.log){n.console.log(i)}},scroll:null};var i=false;var s=1,o="px";var u=[];var a={autoScrollSize:true,autoUpdate:true,disableBodyScroll:false,duration:200,ignoreMobile:true,scrollStep:30,showArrows:false,stepScrolling:true,type:"simple",scrollx:null,scrolly:null,onDestroy:null,onInit:null,onUpdate:null};var f=function(t,n){if(!r.scroll){i&&r.log("Init jQuery Scrollbar v0.2.1");r.scroll=h()}this.container=t;this.options=e.extend({},a);this.scrollTo=null;this.scrollx={};this.scrolly={};this.init(n)};f.prototype={destroy:function(){if(!this.wrapper){return}var n=this.container.scrollLeft();var r=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({height:"",margin:""}).removeClass("scroll-content").removeClass("scroll-scrollx_visible").removeClass("scroll-scrolly_visible").off(".scrollbar").scrollLeft(n).scrollTop(r);this.scrollx.scrollbar.removeClass("scroll-scrollx_visible").find("div").andSelf().off(".scrollbar");this.scrolly.scrollbar.removeClass("scroll-scrolly_visible").find("div").andSelf().off(".scrollbar");this.wrapper.remove();e(t).add("body").off(".scrollbar");if(e.isFunction(this.options.onDestroy))this.options.onDestroy.apply(this,[this.container])},getScrollbar:function(t){var n=this.options["scroll"+t];var r={advanced:'<div class="scroll-arrow scroll-arrow_less"></div>'+'<div class="scroll-arrow scroll-arrow_more"></div>'+'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_inner-wrapper">'+'        <div class="scroll-element_inner scroll-element_track">'+'            <div class="scroll-element_inner-bottom"></div>'+"        </div>"+"    </div>"+'    <div class="scroll-bar">'+'        <div class="scroll-bar_body">'+'            <div class="scroll-bar_body-inner"></div>'+"        </div>"+'        <div class="scroll-bar_bottom"></div>'+'        <div class="scroll-bar_center"></div>'+"    </div>"+"</div>",simple:'<div class="scroll-element_outer">'+'    <div class="scroll-element_size"></div>'+'    <div class="scroll-element_track"></div>'+'    <div class="scroll-bar"></div>'+"</div>"};var i=r[this.options.type]?this.options.type:"advanced";if(n){if(typeof n=="string"){n=e(n).appendTo(this.wrapper)}else{n=e(n)}}else{n=e("<div>").addClass("scroll-element").html(r[i]).appendTo(this.wrapper)}if(this.options.showArrows){n.addClass("scroll-element_arrows_visible")}return n.addClass("scroll-"+t)},init:function(n){var i=this;var u=this.container;var a=e.extend(this.options,n);var f={x:this.scrollx,y:this.scrolly};var l=this.wrapper;var c={scrollLeft:u.scrollLeft(),scrollTop:u.scrollTop()};if(r.mobile&&a.ignoreMobile){return false}if(!l){this.wrapper=l=u.wrap(e("<div>").css({position:u.css("position")=="absolute"?"absolute":"relative"}).addClass("scroll-wrapper").addClass(u.attr("class"))).parent();u.addClass("scroll-content").css({height:"","margin-bottom":r.scroll.height*-1+o,"margin-right":r.scroll.width*-1+o}).on("scroll.scrollbar",function(){f.x.isVisible&&f.x.scroller.css("left",u.scrollLeft()*f.x.kx+o);f.y.isVisible&&f.y.scroller.css("top",u.scrollTop()*f.y.kx+o)});l.on("scroll",function(e){l.scrollTop(0).scrollLeft(0);e.preventDefault();return false});if(a.disableBodyScroll){var h=function(e){d(e)?f.y.isVisible&&f.y.mousewheel(e):f.x.isVisible&&f.x.mousewheel(e)};l.on({"MozMousePixelScroll.scrollbar":h,"mousewheel.scrollbar":h});if(r.mobile){l.on("touchstart.scrollbar",function(n){var r=n.originalEvent.touches&&n.originalEvent.touches[0]||n;var i={pageX:r.pageX,pageY:r.pageY};var s={left:u.scrollLeft(),top:u.scrollTop()};e(t).on({"touchmove.scrollbar":function(e){var t=e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]||e;u.scrollLeft(s.left+i.pageX-t.pageX);u.scrollTop(s.top+i.pageY-t.pageY);e.preventDefault()},"touchend.scrollbar":function(){e(t).off(".scrollbar")}})})}}if(e.isFunction(a.onInit))a.onInit.apply(this,[u])}else{u.css({height:""})}e.each(f,function(n,r){var o=null;var l=1;var c=n=="x"?"scrollLeft":"scrollTop";var h=a.scrollStep;var v=function(){var e=u[c]();u[c](e+h);if(l==1&&e+h>=m)e=u[c]();if(l==-1&&e+h<=m)e=u[c]();if(u[c]()==e&&o){o()}};var m=0;if(!r.scrollbar){r.scrollbar=i.getScrollbar(n);r.scroller=r.scrollbar.find(".scroll-bar");r.mousewheel=function(e){if(!r.isVisible||n=="x"&&d(e)){return true}if(n=="y"&&!d(e)){f.x.mousewheel(e);return true}var t=e.originalEvent.wheelDelta*-1||e.originalEvent.detail;var s=r.size-r.visible-r.offset;if(!(m<=0&&t<0||m>=s&&t>0)){m=m+t;if(m<0)m=0;if(m>s)m=s;i.scrollTo=i.scrollTo||{};i.scrollTo[c]=m;setTimeout(function(){if(i.scrollTo){u.stop().animate(i.scrollTo,240,"linear",function(){m=u[c]()});i.scrollTo=null}},1)}e.preventDefault();return false};r.scrollbar.on({"MozMousePixelScroll.scrollbar":r.mousewheel,"mousewheel.scrollbar":r.mousewheel,"mouseenter.scrollbar":function(){m=u[c]()}});r.scrollbar.find(".scroll-arrow, .scroll-element_track").on("mousedown.scrollbar",function(t){if(t.which!=s)return true;l=1;var f={eventOffset:t[n=="x"?"pageX":"pageY"],maxScrollValue:r.size-r.visible-r.offset,scrollbarOffset:r.scroller.offset()[n=="x"?"left":"top"],scrollbarSize:r.scroller[n=="x"?"outerWidth":"outerHeight"]()};var d=0,g=0;if(e(this).hasClass("scroll-arrow")){l=e(this).hasClass("scroll-arrow_more")?1:-1;h=a.scrollStep*l;m=l>0?f.maxScrollValue:0}else{l=f.eventOffset>f.scrollbarOffset+f.scrollbarSize?1:f.eventOffset<f.scrollbarOffset?-1:0;h=Math.round(r.visible*.75)*l;m=f.eventOffset-f.scrollbarOffset-(a.stepScrolling?l==1?f.scrollbarSize:0:Math.round(f.scrollbarSize/2));m=u[c]()+m/r.kx}i.scrollTo=i.scrollTo||{};i.scrollTo[c]=a.stepScrolling?u[c]()+h:m;if(a.stepScrolling){o=function(){m=u[c]();clearInterval(g);clearTimeout(d);d=0;g=0};d=setTimeout(function(){g=setInterval(v,40)},a.duration+100)}setTimeout(function(){if(i.scrollTo){u.animate(i.scrollTo,a.duration);i.scrollTo=null}},1);return p(o,t)});r.scroller.on("mousedown.scrollbar",function(i){if(i.which!=s)return true;var o=i[n=="x"?"pageX":"pageY"];var a=u[c]();r.scrollbar.addClass("scroll-draggable");e(t).on("mousemove.scrollbar",function(e){var t=parseInt((e[n=="x"?"pageX":"pageY"]-o)/r.kx,10);u[c](a+t)});return p(function(){r.scrollbar.removeClass("scroll-draggable");m=u[c]()},i)})}});e.each(f,function(e,t){var n="scroll-scroll"+e+"_visible";var r=e=="x"?f.y:f.x;t.scrollbar.removeClass(n);r.scrollbar.removeClass(n);u.removeClass(n)});e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});var v=function(t,n){var i="scroll-scroll"+t+"_visible";var s=t=="x"?f.y:f.x;var a=parseInt(u.css(t=="x"?"left":"top"),10)||0;var c=n.size;var h=n.visible+a;n.isVisible=c-h>1;if(n.isVisible){n.scrollbar.addClass(i);s.scrollbar.addClass(i);u.addClass(i)}else{n.scrollbar.removeClass(i);s.scrollbar.removeClass(i);u.removeClass(i)}if(t=="y"&&(n.isVisible||n.size<n.visible)){u.css("height",h+r.scroll.height+o)}if(f.x.size!=u.prop("scrollWidth")||f.y.size!=u.prop("scrollHeight")||f.x.visible!=l.width()||f.y.visible!=l.height()||f.x.offset!=(parseInt(u.css("left"),10)||0)||f.y.offset!=(parseInt(u.css("top"),10)||0)){e.each(f,function(t,n){e.extend(n,t=="x"?{offset:parseInt(u.css("left"),10)||0,size:u.prop("scrollWidth"),visible:l.width()}:{offset:parseInt(u.css("top"),10)||0,size:u.prop("scrollHeight"),visible:l.height()})});v(t=="x"?"y":"x",s)}};e.each(f,v);if(e.isFunction(a.onUpdate))a.onUpdate.apply(this,[u]);e.each(f,function(e,t){var n=e=="x"?"left":"top";var r=e=="x"?"outerWidth":"outerHeight";var i=e=="x"?"width":"height";var s=parseInt(u.css(n),10)||0;var f=t.size;var l=t.visible+s;var c=t.scrollbar.find(".scroll-element_size");c=c[r]()+(parseInt(c.css(n),10)||0);if(a.autoScrollSize){t.scrollbarSize=parseInt(c*l/f,10);t.scroller.css(i,t.scrollbarSize+o)}t.scrollbarSize=t.scroller[r]();t.kx=(c-t.scrollbarSize)/(f-l)||1});u.scrollLeft(c.scrollLeft).scrollTop(c.scrollTop).trigger("scroll")}};e.fn.scrollbar=function(t,n){var r=this;if(t=="get")r=null;this.each(function(){var i=e(this);if(i.hasClass("scroll-wrapper")||i.get(0).nodeName=="body"){return true}var s=i.data("scrollbar");if(s){if(t==="get"){r=s;return false}t=typeof t=="string"&&s[t]?t:"init";s[t].apply(s,e.isArray(n)?n:[]);if(t=="destroy"){i.removeData("scrollbar");while(e.inArray(s,u)>=0)u.splice(e.inArray(s,u),1)}}else{if(typeof t!="string"){s=new f(i,t);i.data("scrollbar",s);u.push(s)}}return true});return r};e.fn.scrollbar.options=a;var l=0;var c=setInterval(function(){var e,t,n,s,o,a,f;for(e=0;e<u.length;e++){s=u[e];t=s.container;n=s.options;o=s.wrapper;a=s.scrollx;f=s.scrolly;if(n.autoUpdate&&o&&o.is(":visible")&&(t.prop("scrollWidth")!=a.size||t.prop("scrollHeight")!=f.size||o.width()!=a.visible||o.height()!=f.visible)){s.init();if(i){r.log({scrollHeight:t.prop("scrollHeight")+":"+s.scrolly.size,scrollWidth:t.prop("scrollWidth")+":"+s.scrollx.size,visibleHeight:o.height()+":"+s.scrolly.visible,visibleWidth:o.width()+":"+s.scrollx.visible},true);if(++l>10){r.log("Scroll updates exceed 10");clearInterval(c)}}}}},300)})(jQuery,document,window)